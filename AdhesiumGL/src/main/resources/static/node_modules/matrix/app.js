var app = angular.module('app', [ 'ui.router' ]);

/**
 * Routes
 */
app.config(function($urlRouterProvider, $stateProvider) {
	$urlRouterProvider.otherwise('/accueil');
	$stateProvider.state('accueil', {
		url : '/accueil',
		templateUrl : 'pck_views/accueil.html'
	});
	$stateProvider.state('display_manage_clients', {
		url : '/display_manage_clients',
		templateUrl : 'pck_clients/display_manage_clients.html'
	});
	$stateProvider.state('display_details_client', {
		url : '/display_details_client',
		templateUrl : 'pck_clients/display_details_client.html'
	});
	$stateProvider.state('display_manage_produits', {
		url : '/display_manage_produits',
		templateUrl : 'pck_produits/display_manage_produits.html'
	});
	$stateProvider.state('display_details_produit', {
		url : '/display_details_produit',
		templateUrl : 'pck_produits/display_details_produit.html'
	});
	$stateProvider.state('contactCard', {
		url : '/card/:contactId',
		controller : 'ContactCardController',
		templateUrl : 'partials/ContactCard.html'
	});
});

/**
 * Controllers
 */
app.controller('RootController', function($scope, $state, $stateParams) {
	$scope.$state = $state;
	$scope.$stateParams = $stateParams;
	$scope.classClients = "submenu";
	$scope.changeClassClients = function(){
		  ($scope.classClients === "submenu")?$scope.classClients = "submenu open":$scope.classClients = "submenu"
	};
	$scope.classProduits = "submenu";
	$scope.changeClassProduits = function(){
		  ($scope.classProduits === "submenu")?$scope.classProduits = "submenu open":$scope.classProduits = "submenu"
	};
	$scope.classAdmins = "submenu";
	$scope.changeClassAdmins = function(){
		  ($scope.classAdmins === "submenu")?$scope.classAdmins = "submenu open":$scope.classAdmins = "submenu"
	};
});
app.controller('ListContactsController', function($scope, ContactService) {
	$scope.contacts = ContactService.getContacts();
});
app.controller('ContactCardController', function($scope, $state, $stateParams,
		ContactService) {
	var contactId = $stateParams.contactId;
	if (!contactId) {
		$state.go('contacts.contactCard', {
			contactId : 1
		});
	} else {
		$scope.currentContact = ContactService.getContactById(contactId);
	}
});

/**
 * Services
 */
app.factory('ContactService', function() {
	var service = {
		getContacts : function() {
			return [ {
				contactId : 1,
				name : 'John',
				fullName : 'John Jenson',
				role : 'Developer',
				employer : 'Cengage'
			}, {
				contactId : 2,
				name : 'Paul',
				fullName : 'Paul Barry',
				role : 'Developer',
				employer : 'Cengage'
			}, {
				contactId : 3,
				name : 'Manoj',
				fullName : 'Manoj Singh',
				role : 'Developer',
				employer : 'Cengage'
			}, {
				contactId : 4,
				name : 'Andrea',
				fullName : 'Andrea Jenkins',
				role : 'Developer',
				employer : 'Cengage'
			}, {
				contactId : 5,
				name : 'Ben',
				fullName : 'Ben Babics',
				role : 'Developer',
				employer : 'Cengage'
			} ];
		},
		getContactById : function(contactId) {
			return _.findWhere(service.getContacts(), {
				contactId : parseInt(contactId)
			});
		}
	};
	return service;
});